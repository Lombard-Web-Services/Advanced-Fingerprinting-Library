// fp.js — Advanced Fingerprinting Library
// Pattern: Constructor + Prototype + Fluent Interface + Module Pattern
// 2026 compatible — No external dependencies
// By Thibaut LOMBARD (@LombardWeb) https://github.com/Lombard-Web-Services/Advanced-Fingerprinting-Library
// MIT License
!function(e){"use strict";let t={H1_SEED:3735928559,H2_SEED:1103547991,defaults:{length:32,casing:"lowercase",scope:"device",includeCanvas:!0,includeAudio:!0,includeWebGL:!1,includeFonts:!1},extend:function(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},hash64:function(e){let n=t.H1_SEED,i=t.H2_SEED;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);n=Math.imul(n^r,2654435761)>>>0,i=Math.imul(i^r,1597334677)>>>0}n^=n>>>16,i^=i>>>16,n=Math.imul(n,2246822507)>>>0,i=Math.imul(i,3266489909)>>>0,n^=n>>>13,i^=i>>>16;let o=BigInt(n)<<32n|BigInt(i);return o.toString(36)},format:function(e,t){switch(t){case"uppercase":return e.toUpperCase();case"mixed":return e.split("").map((e,t)=>t%2==0?e.toUpperCase():e.toLowerCase()).join("");default:return e.toLowerCase()}},normalizeLength:function(e,t){return e.length>=t?e.slice(0,t):(e+e).slice(0,t)}};function n(e){if(!(this instanceof n))return new n(e);this.config=t.extend({},t.defaults),e&&t.extend(this.config,e),this._data=[],this._collected=!1,this._result=null,!1!==this.config.autoCollect&&this.collect()}n.prototype={constructor:n,length:function(e){return this.config.length=Math.max(8,Math.min(64,e)),this},casing:function(e){return this.config.casing=["lowercase","uppercase","mixed"].includes(e)?e:"lowercase",this},scope:function(e){return this.config.scope=["device","browser","session"].includes(e)?e:"device",this},canvas:function(e){return this.config.includeCanvas=!!e,this},audio:function(e){return this.config.includeAudio=!!e,this},webgl:function(e){return this.config.includeWebGL=!!e,this},collect:function(){return this._data=[],this._collectBasic(),("device"===this.config.scope||"browser"===this.config.scope)&&this._collectHardware(),this.config.includeCanvas&&this._collectCanvas(),this.config.includeAudio&&this._collectAudio(),this.config.includeWebGL&&this._collectWebGL(),"browser"===this.config.scope&&this._collectBrowserSpecific(),this._collected=!0,this},_collectBasic:function(){let e=navigator;this._push("ua",e.userAgent||e.userAgentData?.uaFull||""),this._push("lang",e.language||e.languages?.join(",")||""),this._push("tz",Intl.DateTimeFormat().resolvedOptions().timeZone||""),this._push("tzOffset",new Date().getTimezoneOffset())},_collectHardware:function(){let e=navigator;this._push("screen",`${screen.width}x${screen.height}x${screen.colorDepth||24}`),this._push("availScreen",`${screen.availWidth}x${screen.availHeight}`),this._push("cores",e.hardwareConcurrency||"unknown"),this._push("memory",e.deviceMemory||"unknown"),this._push("touch",e.maxTouchPoints||0),this._push("platform",e.platform||"")},_collectCanvas:function(){try{let e=document.createElement("canvas");e.width=256,e.height=60;let t=e.getContext("2d");t.textBaseline="alphabetic",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.font="11pt no-real-font-123",t.fillText("\uD83E\uDD8A LombardWeb 2026 fingerprint \uD83D\uDD8C",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("Cwm fjordbank glyphs vext quiz, \uD83D\uDE03",4,45),t.globalCompositeOperation="multiply",t.fillStyle="rgb(255,0,255)",t.beginPath(),t.arc(50,50,50,0,2*Math.PI),t.closePath(),t.fill(),this._push("canvas",e.toDataURL())}catch(n){this._push("canvas",`error:${n.message}`)}},_collectAudio:async function(){try{let e=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!e){this._push("audio","unsupported");return}let t=new e(1,5e3,44100),n=t.createOscillator();n.type="triangle",n.frequency.value=1e4;let i=t.createDynamicsCompressor();i.threshold.value=-50,i.knee.value=40,i.ratio.value=12,n.connect(i),i.connect(t.destination),n.start(0);let s=await t.startRendering(),r=s.getChannelData(0),o=0;for(let c=4500;c<5e3;c+=3)o=(o<<5)-o+Math.floor(1e4*r[c]);this._push("audio",`sig:${Math.abs(o)}`)}catch(l){this._push("audio",`error:${l.message}`)}},_collectWebGL:function(){try{let e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t){this._push("webgl","unsupported");return}let n=t.getExtension("WEBGL_debug_renderer_info");n&&(this._push("webglVendor",t.getParameter(n.UNMASKED_VENDOR_WEBGL)),this._push("webglRenderer",t.getParameter(n.UNMASKED_RENDERER_WEBGL))),this._push("webglParams",[t.getParameter(t.VERSION),t.getParameter(t.SHADING_LANGUAGE_VERSION),t.getParameter(t.VENDOR)].join("|"))}catch(i){this._push("webgl",`error:${i.message}`)}},_collectBrowserSpecific:function(){this._push("chrome",!!window.chrome),this._push("opr",!!window.opr),this._push("plugins",navigator.plugins?.length||0),this._push("mimeTypes",navigator.mimeTypes?.length||0),navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues(["platform","platformVersion","architecture","model"]).then(e=>{this._push("uaData",JSON.stringify(e))}).catch(()=>{})},_push:function(e,t){this._data.push(`${e}:${t}`)},generate:function(){this._collected||this.collect();let e=this._data.join("###"),n=t.hash64(e),i=t.format(n,this.config.casing);return this._result=t.normalizeLength(i,this.config.length),this._result},generateAsync:async function(){return this.config.includeAudio&&!this._collected&&await this.collect(),this.generate()},raw:function(){return this._data.slice()},get:function(){return this._result},reset:function(){return this._data=[],this._collected=!1,this._result=null,this},compare:function(e){if(this._result||this.generate(),!e||e.length!==this._result.length)return 0;let t=0;for(let n=0;n<this._result.length;n++)this._result[n]===e[n]&&t++;return t/this._result.length}},n.generate=function(e){return new n(e).generate()},n.generateAsync=async function(e){return new n(e).generateAsync()},n.device=function(){return new n({scope:"device"})},n.browser=function(){return new n({scope:"browser"})},n.session=function(){return new n({scope:"session"})},n.compare=function(e,t){if(!e||!t||e.length!==t.length)return 0;let n=0,i=Math.min(e.length,t.length);for(let s=0;s<i;s++)e[s]===t[s]&&n++;return n/i},"undefined"!=typeof module&&module.exports?module.exports=n:(e.Fingerprint=n,e.generateUnifiedFingerprint=function(){return n.generateAsync()})}("undefined"!=typeof window?window:this);
